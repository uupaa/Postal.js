var c=this.self||global;function d(){this._receiver={}}function f(a,b){this._receiver=a;this._to=b}function h(a){return(a||"").__POSTAL_ID__||""}function j(a){if(!a||"function"!==typeof a.inbox)throw Error("Object has not inbox function.");}function p(a){var b=this instanceof d?[]:this._to;void 0===a?b=Object.keys(this._receiver):(j(a),0>b.indexOf(h(a))&&b.push(h(a)));if(this instanceof d)return new f(this._receiver,b);this._to=b;return this}
function q(a){j(a);var b=this instanceof d?Object.keys(this._receiver):this._to;a=b.indexOf(h(a));0<=a&&b.splice(a,1);return this instanceof d?new f(this._receiver,b):this}function r(a,b){if(!a||"string"!==typeof a)throw new TypeError("invalid Postal.send(message: "+a+")");for(var k={},l=Array.prototype.slice.call(arguments),g=this instanceof d?Object.keys(this._receiver):this._to,m=0,t=g.length;m<t;++m){var e=g[m],n=this._receiver[e];n&&(k[e]=n.inbox.apply(n,l))}return k}
function s(a,b){if(!a||"string"!==typeof a)throw new TypeError("invalid Postal.post(message: "+a+")");var k=this,l=Array.prototype.slice.call(arguments),g=this instanceof d?Object.keys(this._receiver):this._to;setTimeout(function(){for(var a=0,b=g.length;a<b;++a){var e=k._receiver[g[a]];e&&e.inbox.apply(e,l)}},0);return{}}var u="process"in c,v=0;d.name="Postal";d.repository="https://github.com/uupaa/Postal.js";
d.prototype={constructor:d,id:h,register:function(a){j(a);var b=h(a);b||(b=(++v).toString(),Object.defineProperty?Object.defineProperty(a,"__POSTAL_ID__",{value:b}):a.__POSTAL_ID__=b);b in this._receiver||(this._receiver[b]=a);return this},unregister:function(a){void 0===a?this._receiver={}:(j(a),(a=h(a))&&delete this._receiver[a]);return this},to:p,omit:q,send:r,post:s};f.name="Envelope";f.prototype={constructor:f,to:p,omit:q,list:function(){return[].concat(this._to)},send:r,post:s};
u&&(module.exports=d);c.Postal?c.Postal_=d:c.Postal=d;
